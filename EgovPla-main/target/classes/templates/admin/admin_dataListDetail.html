<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <title>데이터 상세</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/admin/admin-datalist-deteail.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/footer.css">
</head>
<body>
<th:block th:replace="admin/adminHeader :: headerLayout"></th:block>
<div class="ft">
  <div class="main-container">
    <div class="main-title">
      <h1>데이터 상세</h1>
    </div>
    <form id="frm" method="post" enctype="multipart/form-data">
      <div class="split--div-post"></div>
      <input type="hidden" name="id" th:value="${dataList.id}" />
      <table class="board_detail">
        <tbody>
        <tr>
          <th>제목</th>
          <td colspan="2"><input type="text" id="title" name="title" th:value="${dataList.title }" /></td>
          <th:block th:if="${not #strings.isEmpty(dataList.a21)}">
            <td><a th:href="${dataList.a21}" target="_blank" class="custom-btn">바로가기</a></td>
          </th:block>
        </tr>
        <tr>
          <th>내용</th>
          <td colspan="3">
            <textarea id="content" name="content" >[[${dataList.content}]]</textarea>
          </td>
        </tr>
        <th:block th:if="${dataList.files != null and !dataList.files.isEmpty()}">
          <tr id="existingFiles">
            <th>첨부 파일</th>
            <td colspan="3">
              <div th:each="file : ${dataList.files}">
                <!-- 엑셀 및 CSV 파일 다운로드 -->
                <div th:if="${#strings.endsWith(file.fileName, '.csv') or
                              #strings.endsWith(file.fileName, '.xls') or
                              #strings.endsWith(file.fileName, '.xlsx')}"
                     style="display: flex; align-items: center; gap: 10px;">
                  <a th:href="@{/download(filename=${file.fileName})}" download>
                    <img th:src="@{/images/file40.png}" alt="파일 다운로드 이미지" style="width: 30px; height: 30px;" />
                  </a>
                  <p th:text="${file.fileName}" style="margin: 0;"></p>
                </div>
              </div>
            </td>
          </tr>
        </th:block>
        <tr>
          <th>새로운 첨부 파일</th>
          <td colspan="3">
            <input type="file" id="file" name="files" accept=".csv,.xls,.xlsx" multiple />
          </td>
        </tr>
        </tbody>
      </table>
      <div class="main-title">
        <h1>파일데이터 정보</h1>
      </div>
      <table class="board_detail">
        <tbody>
        <tr>
          <th>파일데이터명</th>
          <td colspan="3">
            <input type="text" id="a1" name="a1" th:value="${dataList.a1}"  />
          </td>
        </tr>
        <tr>
          <th>분류체계</th>
          <td>
            <input type="text" id="a2" name="a2" th:value="${dataList.a2}"  />
          </td>
          <th>제공기관</th>
          <td>
            <input type="text" id="a3" name="a3" th:value="${dataList.a3}"  />
          </td>
        </tr>
        <tr>
          <th>관리부서명</th>
          <td>
            <input type="text" id="a4" name="a4" th:value="${dataList.a4}"  />
          </td>
          <th>관리부서 전화번호</th>
          <td>
            <input type="text" id="a5" name="a5" th:value="${dataList.a5}"  />
          </td>
        </tr>
        <tr>
          <th>보유근거</th>
          <td>
            <textarea id="a6" name="a6" >[[${dataList.a6}]]</textarea>
          </td>
          <th>수집방법</th>
          <td>
            <textarea id="a7" name="a7" >[[${dataList.a7}]]</textarea>
          </td>
        </tr>
        <tr>
          <th>업데이트 주기</th>
          <td>
            <input type="text" id="a8" name="a8" th:value="${dataList.a8}"  />
          </td>
          <th>차기 등록 예정일</th>
          <td>
            <input type="text" id="a9" name="a9" th:value="${dataList.a9}"  />
          </td>
        </tr>
        <tr>
          <th>매체유형</th>
          <td>
            <input type="text" id="a10" name="a10" th:value="${dataList.a10}"  />
          </td>
          <th>전체 행</th>
          <td>
            <input type="text" id="a11" name="a11" th:value="${dataList.a11}"  />
          </td>
        </tr>
        <tr>
          <th>확장자</th>
          <td>
            <input type="text" id="a12" name="a12" th:value="${dataList.a12}"  />
          </td>
          <th>키워드</th>
          <td>
            <input type="text" id="a13" name="a13" th:value="${dataList.a13}"  />
          </td>
        </tr>
        <tr>
          <th>등록일</th>
          <td>
            <input type="text" id="createdAt" name="createdAt" th:value="${#temporals.format(dataList.createdAt,'yyyy-MM-dd')}"/>
          </td>
          <th>수정일</th>
          <td>
            <input type="text" id="updatedAt" name="updatedAt" th:value="${#temporals.format(dataList.updatedAt,'yyyy-MM-dd')}"/>
          </td>
        </tr>
        <tr>
          <th>데이터한계</th>
          <td colspan="3">
            <input type="text" id="a14" name="a14" th:value="${dataList.a14}"  />
          </td>
        </tr>
        <tr>
          <th>제공형태</th>
          <td colspan="3">
            <input type="text" id="a15" name="a15" th:value="${dataList.a15}"  />
          </td>
        </tr>
        <tr>
          <th>URL</th>
          <td colspan="3">
            <a th:href="${dataList.a21}" th:text="${dataList.a21}" target="_blank"></a>
          </td>
        </tr>
        <tr>
          <th>설명</th>
          <td colspan="3">
            <textarea id="a16" name="a16" >[[${dataList.a16}]]</textarea>
          </td>
        </tr>
        <tr>
          <th>기타 유의사항</th>
          <td colspan="3">
            <textarea id="a17" name="a17" >[[${dataList.a17}]]</textarea>
          </td>
        </tr>
        <tr>
          <th>비용부과 유무</th>
          <td>
            <input type="text" id="a18" name="a18" th:value="${dataList.a18}"  />
          </td>
          <th>비용부과기준 및 단위</th>
          <td>
            <input type="text" id="a19" name="a19" th:value="${dataList.a19}"  />
          </td>
        </tr>
        <tr>
          <th>이용허락범위</th>
          <td colspan="3">
            <input type="text" id="a20" name="a20" th:value="${dataList.a20}"  />
          </td>
        </tr>
        </tbody>
      </table>
      <div class="main-title" id="preview">
        <h3>미리보기</h3>
        <div style="max-height: 150px; max-width: 100%; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background-color: #fff; white-space: normal; font-size: 14px; line-height: 1.6;">
          <p th:utext="${dataList.preview}" style="margin: 0;"></p>
        </div>
      </div>
    </form>
    <div class="admin10-button-group">
      <a href="#this" id="list" class="mbtn" >목록으로</a>
      <a href="#this" id="edit" class="rbtn">수정하기</a>
      <a href="#this" id="delete" class="dbtn">삭제하기</a>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $("#list").on("click", function(){
      location.href = "/admin/dataList";
    });
    $("#edit").on("click", function(){
      var frm = $("#frm")[0];
      frm.action = "/admin/dataList/update";
      frm.submit();
    });

    $("#delete").on("click", function(){
      var frm = $("#frm")[0];
      frm.action = "/admin/dataList/delete";
      frm.submit();
    });
  });
  document.getElementById('file').addEventListener('change', function(event) {
    let files = event.target.files;
    let existingFilesContainer = document.getElementById('existingFiles');
    let previewContainer = document.getElementById('preview');
    if (existingFilesContainer) {
      existingFilesContainer.style.display = 'none';
      previewContainer.style.display = 'none';
    }
    for (let i = 0; i < files.length; i++) {
      let fileName = files[i].name.toLowerCase();
      if (!(fileName.endsWith('.csv') || fileName.endsWith('.xls') || fileName.endsWith('.xlsx'))) {
        alert('CSV 또는 엑셀 파일만 업로드 가능합니다.');
        event.target.value = '';  // 입력 필드를 초기화
        return;
      }
    }
  });

</script>
</div>
<div class="footers"></div> <!-- 이거 지우면 안됨 -->
<th:block th:replace="layout/footer :: footerLayout"></th:block>
</body>
</html>
